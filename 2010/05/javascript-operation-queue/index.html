<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Javascript Operation Queue</title>
  <meta name="description" content="When developing for a platform that relies on asynchronous APIs, such as webOS, the application logic frequently will need to block on a given operation prio...">

  <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2010/05/javascript-operation-queue/">
  <link rel="alternate" type="application/rss+xml" title="incaseofstairs" href="/feed.xml">
  
  
</head>

  <body>
    <div class="mdl-layout__container">
      <div class="mdl-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header mdl-layout__header--waterfall" role="banner">
  <div class="mdl-layout__header-row centered-content"">
    
    <a class="mdl-layout__title" href="/">
      <img class="avatar" src="https://avatars3.githubusercontent.com/kpdecker?v=3&s=50" alt="kpdecker" srcset="https://avatars3.githubusercontent.com/kpdecker?v=3&s=50 1x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=100 2x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=150 3x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=200 4x" width="50" height="50" data-proofer-ignore="true" />
    </a>
    
    <div class="mdl-layout-spacer"></div>

    <nav class="mdl-navigation">
  
    
    <a class="mdl-navigation__link" href="/">About</a>
  
    
    <a class="mdl-navigation__link" href="/blog">Blog</a>
  
    
    <a class="mdl-navigation__link" href="/resume">Resume</a>
  
</nav>

  </div>
</header>


        <main class="mdl-layout__content" aria-label="Content">
          <article class="post centered-content" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      Javascript Operation Queue
      <time datetime="2010-05-28T00:00:00-05:00" itemprop="datePublished" class="post-meta">
        
        May 28, 2010
      </time>
    </h1>
  </header>
  <hr />

  <div class="post-content" itemprop="articleBody">
    <p>When developing for a platform that relies on asynchronous APIs, such as webOS, the application logic frequently will need to block on a given operation prior to executing other dependent components. This may include anything from loading user data after authentication to saving data after initialization of a given data structure among others.</p>

<p>One method of handling this problem is to make the blocker component explicitly aware of the dependent components and the unique interface to each component, which works for simple cases or situations where the dependent to blocking relationship is one-to-one, but this quickly becomes complicated as a number of dependent components grows. In the extreme cases the blocker may have to be aware of significant portions of the system, leading to maintenance concerns.</p>

<p>Alternatively the blocker call can allow dependent components to register their interest in the completion of the operation and upon completion the blocker can simply notify the components on this list in a generic fashion. This allows that components to remain loosely coupled and has the added benefit of allowing for run-time conditional relationships without requiring that the blocker be aware of the state of the dependent.</p>

<p>Implementing such a notification system is fairly straightforward in Javascript: Simply collect waiting callbacks in an array or other structure then executing each upon completion of the blocking call.</p>

<h3 id="library">Library</h3>

<p>While simple to implement, my experience on<a href="http://www.facebook.com/apps/application.php?id=4620273157">Facebook for webOS</a> has shown that a library to implement this behavior is worth the initial effort as manually writing nearly identical for loops over callbacks for the umpteenth time becomes tedious and error-prone.</p>

<p>To this end, we developed and open sourced the <code class="highlighter-rouge">OperationQueue</code> class which provides a common implementation that doesnâ€™t require far too many for loops :)</p>

<h3 id="usage">Usage</h3>

<p>To use the <code class="highlighter-rouge">OperationQueue</code> class you simply need to enqueue your dependent operations using the <code class="highlighter-rouge">queue</code> API.</p>

<p><code class="highlighter-rouge">queue</code> can accept a single function which will be called upon successful completion.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="nx">opQueue</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do something with the data that we were waiting for!</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Blocking Operation Completed!"</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre>
</div>

<p>It also accepts an object with any combination of <code class="highlighter-rouge">onSuccess</code> and <code class="highlighter-rouge">onFailure</code> fields who will be called for each respective event.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="nx">opQueue</span><span class="p">.</span><span class="nx">queue</span><span class="p">({</span>
        <span class="na">onSuccess</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Do something with the data that we were waiting for!</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Blocking Operation Completed!"</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">onFailure</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Blocking Operation Failed"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre>
</div>

<p>These calls may occur at anytime. If the blocking operation has already completed then calls to <code class="highlighter-rouge">queue</code> will result in immediate execution of the queued operation. In this case the result object will not be included.</p>

<p>For the blocking call itself the <code class="highlighter-rouge">getSuccessHandler</code> and <code class="highlighter-rouge">getFailureHandler</code> generators will return callback functions that may be used to directly on completion or may be passed as callback handlers to the async API. These methods also accept a function parameter which will be called prior to their completion.</p>

<p>Used directly:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">opQueue</span><span class="p">.</span><span class="nx">getSuccessHandler</span><span class="p">())();</span>
</code></pre>
</div>

<p>As a callback:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">ServiceRequestWrapper</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">'palm://com.palm.preferences/systemProperties'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span><span class="s2">"Get"</span><span class="p">,</span>
        <span class="na">parameters</span><span class="p">:{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"com.palm.properties.nduid"</span> <span class="p">},</span>
        <span class="na">onSuccess</span><span class="p">:</span> <span class="nx">opQueue</span><span class="p">.</span><span class="nx">getSuccessHandler</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Mojo</span><span class="p">.</span><span class="nx">Log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">"Device ID: %j"</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="p">}),</span>
        <span class="na">onFailure</span><span class="p">:</span> <span class="nx">opQueue</span><span class="p">.</span><span class="nx">getFailureHandler</span><span class="p">()</span>
    <span class="p">});</span>
</code></pre>
</div>

<p>For more complicated use cases, the <code class="highlighter-rouge">reset</code> function allows for enabling and disabling queuing at any time. For example, if you need to initially allow all operations to proceed and then block only while a given operation is in progress, the <code class="highlighter-rouge">getSuccessHandler</code> API may be called immediately after instantiation of the queue and then <code class="highlighter-rouge">reset</code> called prior to execution of the blocking operation.</p>

<h3 id="source">Source:</h3>

<p><a href="http://github.com/palm/webos-samples/tree/master/tipsAndTricks/operation-queue/">Operation queue</a> is available in the <a href="http://github.com/palm/webos-samples/">webos-samples</a> repository on github, within the <a href="http://github.com/palm/webos-samples/tree/master/tipsAndTricks/">tipsAndTricks</a> subproject.</p>

<p>One final note: While this was written for a webOS application, it does not depend on any webOS-specific constructs and may be used in any Javascript environment. To see it in action, check out the <a href="http://demo.incaseofstairs.com/operation-queue/">demo</a> in any browser!</p>

  </div>

  


  <div class="post-navigation">
    
      <a href="/2010/05/border-image-generator-local-file-access/">&laquo; border-image-generator: Local File Access</a>
    
    
      <a href="/2010/05/facebook-for-webos-seed-status/">Facebook for webOS: Seed Status &raquo;</a>
    
  </div>
</article>

          <footer class="mdl-mini-footer">
  <div class="centered-content">
    <div class="footer-links">
      <ul class="contact-list">
        <li>
          
            Kevin Decker
          
          </li>
          
          <li><a href="mailto:kpdecker@gmail.com">kpdecker@gmail.com</a></li>
          
          
          <li><a href="https://kpdecker.github.io/resume/">Resume</a></li>
          
      </ul>

      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/kpdecker"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg></span></a>
        </li>
        

        
        <li>
          <a href="https://twitter.com/kpdecker"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg></span></a>
        </li>
        

        
        <li>
          <a href="https://linkedin.com/kpdecker"><span class="icon icon--linkedin"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="rgb(130, 130, 130)" d="M1.7 0C.7 0 0 .7 0 1.6 0 2.4.7 3 1.7 3s1.8-.6 1.8-1.4C3.5.6 2.8 0 1.7 0zM0 15h3.4V4.3H0V15zM12.3 4.5c-1 0-2-.2-3.2 1.4V4H6v11h3.4V8c.3-.5 1-1 1.8-1 1.2 0 1.7.8 1.7 2v6h3V8.7c0-3-1.8-4.2-4-4.2z"/></svg></span></a>
        </li>
        
      </ul>

      <p>Personal musings on software engineering.</p>
    </div>
  </div>
</footer>
        </main>
      </div>
    </div>
  </body>
</html>
