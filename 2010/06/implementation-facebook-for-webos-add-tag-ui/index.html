<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Implementation: Facebook for webOS Add Tag UI</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2010/06/implementation-facebook-for-webos-add-tag-ui/">
  <link rel="alternate" type="application/rss+xml" title="incaseofstairs" href="/feed.xml">
  
  
</head>

  <body>
    <div class="mdl-layout__container">
      <div class="mdl-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header mdl-layout__header--waterfall" role="banner">
  <div class="mdl-layout__header-row centered-content"">
    
    <a class="mdl-layout__title" href="/">
      <img class="avatar" src="https://avatars3.githubusercontent.com/kpdecker?v=3&s=50" alt="kpdecker" srcset="https://avatars3.githubusercontent.com/kpdecker?v=3&s=50 1x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=100 2x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=150 3x, https://avatars3.githubusercontent.com/kpdecker?v=3&s=200 4x" width="50" height="50" data-proofer-ignore="true" />
    </a>
    
    <div class="mdl-layout-spacer"></div>

    <nav class="mdl-navigation">
  
    
    <a class="mdl-navigation__link" href="/">About</a>
  
    
    <a class="mdl-navigation__link" href="/blog">Blog</a>
  
    
    <a class="mdl-navigation__link" href="/resume">Resume</a>
  
</nav>

  </div>

  <div class="mdl-layout__drawer">
    <a class="mdl-layout__title" href="/">incaseofstairs</a>
    <div class="mdl-layout-spacer"></div>

    <nav class="mdl-navigation">
  
    
    <a class="mdl-navigation__link" href="/">About</a>
  
    
    <a class="mdl-navigation__link" href="/blog">Blog</a>
  
    
    <a class="mdl-navigation__link" href="/resume">Resume</a>
  
</nav>
  
  </div>
</header>


        <main class="mdl-layout__content" aria-label="Content">
          <article class="post centered-content" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Implementation: Facebook for webOS Add Tag UI</h1>
    <p class="post-meta">
      <time datetime="2010-06-04T17:29:40-05:00" itemprop="datePublished">
        
        Jun 4, 2010
      </time>
    </p>
  </header>
  <hr />

  <div class="post-content" itemprop="articleBody">
    <p><img src="/assets/add-tag.png" alt="Add Tag Interface" /></p>

<p>Yesterday we released <a href="http://developer.palm.com/blog/2010/06/facebook-1-2-5-beta-photo-tagging-and-more/">Facebook for webOS 1.2.5 Beta</a> which brings many improvements to our photo functionality including tagging support. Now that the release is out the door, I’d like to take some time to discuss the cooler aspects of the implementation particularly the Add Tag UI.</p>

<h3 id="design">Design</h3>

<p>The core layout of the Add Tag UI is an overlay container containing a fixed position header and a scrolling list below that. The entire screen is covered by these two elements, with the header section maintain its height and the content section expanding to cover the remainder.</p>

<p>This fixed header layout is fairly common throughout the app, the most common example being the navbar used in the majority of the application’s scenes, and is fairly easy to solve if the header is a fixed height and the content scrolls under the header. All that needs to be done is to position the header control using <code class="highlighter-rouge">position: fixed</code> and apply a <code class="highlighter-rouge">margin-top</code> to the list such that the first element in the list appears at the bottom of the fixed element.</p>

<p>I’ve never really like this solution as it requires that the header height be fixed and the list section be “aware” of the header rather than being only concerned about it’s own layout. With this in mind (and also wanting to play around with some of the cool things that WebKit offers but I have not been able to use on projects due to the IE factor), I decided to try out the flexible box layout type in webOS.</p>

<h3 id="flexible-box-layout">Flexible Box Layout</h3>

<p>To provide some background, one of the key goals of the <a href="http://www.w3.org/TR/css3-flexbox/">flexible box layout module</a> is the ability to specify the size and growth of an element relative to both it’s siblings and it’s parent. While this was previously possible by using percentage layouts, each of the elements had to be aware of the size that their siblings expected and all elements needed to use the same relative system.</p>

<p>This is not the case with this layout scheme. Rather than defining a percentage of the container size, elements are defined with an affinity for the excess space in the container. This means that the layout first attempts to fit everything as it would normally layout, then adjusts each element based on the difference in size between the children and the parent. In practice this can generate much more stable, but still fluid layouts when creating applications in HTML+CSS.</p>

<p>The <code class="highlighter-rouge">box-flex</code> (<a href="https://developer.mozilla.org/en/CSS/-moz-box-flex">-moz-box-flex</a>, <a href="http://developer.apple.com/safari/library/documentation/AppleApplications/Reference/SafariCSSRef/Articles/StandardCSSProperties.html#//apple_ref/doc/uid/TP30001266--webkit-box-flex">-webkit-box-flex</a>) is used to define the resize affinity.</p>

<p>Values here can range from zero to any positive decimal value. When the value is zero, the element will not change size based on extra or lack of space in its parent. When this value is larger than zero the element is considered flexible. This means that when the layout engine determines that the parent box is either overflowed or underflowed these elements will expand or shrink such that all of the children fill the container. The differences in magnitudes of this value determines how the flexible elements are resized.</p>

<p>As an example a vertically oriented flexible box with 3 children whose flex values are 0, 1, and 2 and has 60px of open space will add 20px to the second element, 40px to the third element and leave the height of the first unchanged. On the other end of the spectrum if there is an overflow of 60px, the elements will be shrunk by the same dimensions above.</p>

<p>The flexible box model is <a href="http://caniuse.com/#feat=flexbox">supported</a> by Safari 3+, Chrome 3+, Firefox 3+, and of course webOS. As covering the entirety of the specification was out of the scope of this post I would recommend reading some of the other <a href="http://hacks.mozilla.org/2010/04/the-css-3-flexible-box-model/">excellent</a> <a href="http://www.the-haystack.com/2010/01/23/css3-flexbox-part-1/">sources</a> on this topic as well as the <a href="http://www.w3.org/TR/css3-flexbox/">specification</a> itself.</p>
<h3 id="implementation">Implementation</h3>

<p>For the Add Tag UI, we take advantage of the flexible overflow case outlined above. This allows the upper section to layout at it’s natural size using <code class="highlighter-rouge">-webkit-box-flex: 0</code> and the user list section to expand to fill the remainder of the page using <code class="highlighter-rouge">-webkit-box-flex: 1</code>. By defining the list section to be a <code class="highlighter-rouge">Scroller</code> with an embedded <code class="highlighter-rouge">List</code>, we can maintain fixed behavior for the upper section and still allow for an arbitrary number of users.</p>

<p>Implemented this looks something like the following:&lt;/p&gt;</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tag-selector"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tag-selector-panel"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">x-mojo-element=</span><span class="s">"TextField"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-wrapper"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">x-mojo-element=</span><span class="s">"Button"</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">x-mojo-element=</span><span class="s">"Button"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tag-scroller"</span> <span class="na">x-mojo-element=</span><span class="s">"Scroller"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">x-mojo-element=</span><span class="s">"List"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<p>With the CSS doing most of the heavy lifting:</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="nc">.tag-selector</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>

  <span class="nl">z-index</span><span class="p">:</span> <span class="m">1000</span><span class="p">;</span>

  <span class="nl">display</span><span class="p">:</span> <span class="n">-webkit-box</span><span class="p">;</span>
  <span class="nl">-webkit-box-orient</span><span class="p">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.tag-scroller</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">static</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="nl">-webkit-box-flex</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>A live demo for Firefox and Safari/Chrome available is available <a href="http://demo.incaseofstairs.com/flex-box/index.html">here</a>. Note that the demo is running a modified version to handle desktop and cross-browser differences. These are mostly experimental prefix concerns i.e. <code class="highlighter-rouge">display: -webkit-box</code> becomes</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code>    <span class="nt">display</span><span class="o">:</span> <span class="nt">-webkit-box</span><span class="o">;</span>
    <span class="nt">display</span><span class="o">:</span> <span class="nt">-moz-box</span><span class="o">;</span>
    <span class="nt">display</span><span class="o">:</span> <span class="nt">box</span><span class="o">;</span>
</code></pre>
</div>

<p>Although there are a few hacks in place to force common layout under both WebKit and Gecko (See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=570036">Bug 570036</a>). Such is life developing with CSS3 :)</p>

<h3 id="future-posts">Future Posts</h3>

<p>As a final note, I’d like to start a series of these posts. Are there any sections of the Facebook app that you would like me to provide an overview of their implementation? Feel free to comment on this post or drop me a line at <a href="mailto:kpdecker@gmail.com">kpdecker@gmail.com</a>.</p>

  </div>

  


  <div class="post-navigation">
    
      <a href="/2010/08/jsperf/">&laquo; jsPerf</a>
    
    
      <a href="/2010/05/border-image-generator-local-file-access/">border-image-generator: Local File Access &raquo;</a>
    
  </div>
</article>

          <footer class="mdl-mini-footer">
  <div class="centered-content">
    <h2 class="mdl-logo">incaseofstairs</h2>

    <div class="footer-links">
      <ul class="contact-list">
        <li>
          
            Kevin Decker
          
          </li>
          
          <li><a href="mailto:kpdecker@gmail.com">kpdecker@gmail.com</a></li>
          
          
          <li><a href="https://kpdecker.github.io/resume/">Resume</a></li>
          
      </ul>

      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/kpdecker"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg></span></a>
        </li>
        

        
        <li>
          <a href="https://twitter.com/kpdecker"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg></span></a>
        </li>
        

        
        <li>
          <a href="https://linkedin.com/kpdecker"><span class="icon icon--linkedin"><svg viewBox="0 0 16 16" width="32px" height="32px"><path fill="rgb(130, 130, 130)" d="M1.7 0C.7 0 0 .7 0 1.6 0 2.4.7 3 1.7 3s1.8-.6 1.8-1.4C3.5.6 2.8 0 1.7 0zM0 15h3.4V4.3H0V15zM12.3 4.5c-1 0-2-.2-3.2 1.4V4H6v11h3.4V8c.3-.5 1-1 1.8-1 1.2 0 1.7.8 1.7 2v6h3V8.7c0-3-1.8-4.2-4-4.2z"/></svg></span></a>
        </li>
        
      </ul>

      <p>Personal musings on software engineering with a skew towards frontend engineering.
</p>
    </div>
  </div>
</footer>
        </main>
      </div>
    </div>
  </body>
</html>
